services:
  # 1. Vector Database
  qdrant:
    image: qdrant/qdrant:latest
    container_name: compliance_qdrant
    ports:
      - "6333:6333"
    volumes:
      - ./qdrant_data:/qdrant/storage

  # 2. Observability (The "Eyes")
  phoenix:
    image: arizephoenix/phoenix:latest
    container_name: compliance_phoenix
    ports:
      - "6006:6006" # UI
      - "4317:4317" # Log Receiver
    environment:
      - PHOENIX_PORT=6006
      - PHOENIX_GRPC_PORT=4317

  # 3. The Agent Application
  app:
    build: .
    container_name: compliance_app
    ports:
      - "8000:8000"
    depends_on:
      - qdrant
      - phoenix
    environment:
      # Networking: Point to service names, NOT localhost
      - QDRANT_HOST=qdrant
      - QDRANT_PORT=6333
      
      # Point traces to the Phoenix container (port 4317)
      - PHOENIX_COLLECTOR_ENDPOINT=http://phoenix:4317
      
      # Secrets (passed from host .env)
      - GOOGLE_API_KEY=${GOOGLE_API_KEY}
